var util = require('util');
var API = require('./base.js');
var fns = require('./functions')

var BaseAPI = function(appID, host) {
    API.call(this, appID, host);
    this._version = '3'; // 缺省第三版
};

util.inherits(BaseAPI, API);

function getUrl (appendURL) {
    this._check('_host', '_appID', '_version');
    appendURL = (appendURL||'').replace(/^\//, '');
    return [this._host, this._version, appendURL].join('/');
};
/**
 *  网络请求
 *  @returns Promise
 */
BaseAPI.prototype.send = function(options) {
    options.method = options.method || 'GET';
    options.url = getUrl.call(this, options.url);
    return this.request(options);
};
/**
 *  修改host
 */
BaseAPI.prototype.host = function(host) {
    this._host = host;
    return this;
};
/**
 * 修改版本 
 */
BaseAPI.prototype.version = function(version) {
    this._version = version;
    return this;
};
/**
 *  返回request的qs选项，第三版默认加上_app_id
 *  @override base._getRequestParams
 *  @returns {Object}
 */
BaseAPI.prototype._getRequestParams = function() {
    this._params._app_id = this._appID;
    return this._params;
};

module.exports = BaseAPI;